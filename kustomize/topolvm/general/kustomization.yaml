resources:
  - ns-topolvm.yaml

helmCharts:
  - name: topolvm
    releaseName: topolvm
    valuesInline:
      node:
        nodeSelector:
          node-role.kubernetes.io/control-plane: ""
      controller:
        replicaCount: 1
        nodeSelector:
          node-role.kubernetes.io/control-plane: ""
      scheduler:
        nodeSelector:
          node-role.kubernetes.io/control-plane: ""
      cert-manager:
        enabled: true
      storageClasses:
        - name: general  # Defines name of storage class.
          storageClass:
            fsType: xfs  # Supported filesystems are: ext4, xfs, and btrfs.
            # reclaimPolicy
            reclaimPolicy:  # Delete
            # Additional annotations
            annotations: {}
            # Default storage class for dynamic volume provisioning
            # ref: https://kubernetes.io/docs/concepts/storage/dynamic-provisioning
            isDefaultClass: false
            # volumeBindingMode can be either WaitForFirstConsumer or Immediate. WaitForFirstConsumer is recommended because TopoLVM cannot schedule pods wisely if volumeBindingMode is Immediate.
            volumeBindingMode: WaitForFirstConsumer
            # enables CSI drivers to expand volumes. This feature is available for Kubernetes 1.16 and later releases.
            allowVolumeExpansion: true
            additionalParameters:
              topolvm.io/device-class: "general"
            # mount options
            mountOptions: []
      # lvmd service
      lvmd:
        nodeSelector:
          node-role.kubernetes.io/control-plane: ""
        # lvmd.managed -- If true, set up lvmd service with DaemonSet.
        managed: true
        # lvmd.socketName -- Specify socketName.
        socketName: /run/topolvm/lvmd.sock
        # lvmd.deviceClasses -- Specify the device-class settings.
        deviceClasses:
          - name: general
            volume-group: vg-general
            default: true
            spare-gb: 10
    namespace: topolvm-system
    repo: https://topolvm.github.io/topolvm
